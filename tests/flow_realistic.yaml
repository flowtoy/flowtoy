sources:
  identity_shortname:
    type: env
    configuration:
      vars: [SHORTNAME]

  ldap_service:
    type: tests.mocks.ldap_mock:LdapConnector

  hr_service:
    type: tests.mocks.rest_hr_mock:RestConnector

  sis_programs:
    type: tests.mocks.rest_sis_mock:RestConnector
    configuration:
      endpoint: programs

  sis_courses:
    type: tests.mocks.rest_sis_mock:RestConnector
    configuration:
      endpoint: courses

  grouper_service:
    type: tests.mocks.process_grouper_mock:ProcessConnector

flow:
  - name: get_shortname
    source: identity_shortname
    output:
      - name: shortname
        type: json

  - name: ldap_lookup
    source: ldap_service
    input:
      type: parameter
      value: "{{ flows.get_shortname.shortname.SHORTNAME }}"
    output:
      - name: ldap
        type: json

  - name: hr_lookup
    source: hr_service
    input:
      type: parameter
      value: "{{ flows.ldap_lookup.ldap.uid }}"
    output:
      - name: jobs
        type: json

  - name: sis_programs
    source: sis_programs
    input:
      type: parameter
      value: "{{ flows.ldap_lookup.ldap.uid }}"
    output:
      - name: programs
        type: json

  - name: sis_courses
    source: sis_courses
    input:
      type: parameter
      value: "{{ flows.ldap_lookup.ldap.uid }}"
    output:
      - name: courses
        type: json

  - name: grouper_lookup
    source: grouper_service
    input:
      type: parameter
      value: "{{ flows.ldap_lookup.ldap.uid }}"
    output:
      - name: groups
        type: json
